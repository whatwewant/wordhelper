var WordHelper={popover_id:"#wordhelper_popover",popover_id_name:"wordhelper_popover",getOffset:function(e,o){var t=0;switch(e.toLowerCase()){case"left":t=o.offsetLeft;break;case"top":t=o.offsetTop}return o.offsetParent?t+this.getOffset(e,o.offsetParent):t},setPopoverPosition:function(e,o){$(wordhelper_popover).css({position:"absolute",left:e,top:o})},getSelectionOffset:function(e){var o=window.innerWidth/2,t=window.innerHeight/2,i=window.getSelection();if(i.rangeCount>0){var n=i.getRangeAt(0),s=document.createElement("span");n.insertNode(s),o=this.getOffset("left",s)-50-s.offsetLeft+$(s).position().left,t=this.getOffset("top",s)+25-s.offsetTop+$(s).position().top,s.remove(),window.getSelection().addRange(n)}e(o,t)},hidePopover:function(){$(this.popover_id).remove()},playAudio:function(e){e&&new Howl({urls:[e]}).play()},popover:function(e){var o=e.wordhelper,t=e.webster,i="",n="<div id="+this.popover_id_name+'><div class="popover-inner"><h3 class="popover-title">';!0===o.loading?n+='<p><span class="word">'+o.msg+"</span></p>":1!=o.status_code&&o.data?(n+='<p><span class="word">'+o.data.content+'</span><small class="pronunciation">'+(o.data.pron?"["+o.data.pron+"]":"")+"</small></p>",n+=window.location.protocol.indexOf("https")<0?'<a href="#" class="speak uk">UK<i class="icon icon-speak"></i></a><a href="#" class="speak us">US<i class="icon icon-speak"></i></a></h3>':"</h3>",n+='<div class="popover-content">  <p>'+o.data.definition.split("\n").join("<br />")+"<br />"+i+"</p></div>"):n+=void 0===t||""===t.term?"未找到单词</h3></div>":'<p><span class="word">'+t.term+'</span></p></h3><div class="popover-content"><p>'+t.defs+"</p></div>",n+="</div></div>",$(this.popover_id).remove(),$("body").append(n),this.getSelectionOffset(function(e,o){this.setPopoverPosition(e,o)}.bind(this)),$(this.popover_id+" .speak.us").click(function(e){e.preventDefault();var t="http://media.shanbay.com/audio/us/"+o.data.content+".mp3";this.playAudio(t)}.bind(this)),$(this.popover_id+" .speak.uk").click(function(e){e.preventDefault();var t="http://media.shanbay.com/audio/uk/"+o.data.content+".mp3";this.playAudio(t)}.bind(this)),$("html").click(function(){this.hidePopover()}.bind(this)),$("body").on("click",this.popover_id,function(e){})}};!function(e){e(document).ready(function(){e(document).on("dblclick",function(){var o=document.getSelection(),t=o.getRangeAt(0).toString();t&&new RegExp(/^[a-z]+$/i).test(t)&&(t=t.toLowerCase(),WordHelper.popover({wordhelper:{loading:!0,msg:"正在查询..."}}),e.ajax({url:"http://shanbay.com/api/v1/bdc/search/?word="+t+"&_="+(new Date).getTime(),method:"GET",dataType:"json",success:function(e){WordHelper.popover({wordhelper:{loading:!1,data:e.data,status_code:e.status_code,msg:e.msg}})}.bind(o),error:function(e){console.log("Word Helper Search Error "+e.toString())}}))})})}($);