var WordHelper={popover_id:"#wordhelper_popover",popover_id_name:"wordhelper_popover",getOffset:function(o,e){var t=0;switch(o.toLowerCase()){case"left":t=e.offsetLeft;break;case"top":t=e.offsetTop}return e.offsetParent?t+this.getOffset(o,e.offsetParent):t},setPopoverPosition:function(o,e){$(wordhelper_popover).css({position:"absolute",left:o,top:e})},getSelectionOffset:function(o){var e=window.innerWidth/2,t=window.innerHeight/2,i=window.getSelection();if(i.rangeCount>0){var n=i.getRangeAt(0),s=document.createElement("span");n.insertNode(s),e=this.getOffset("left",s)-50-s.offsetLeft+$(s).position().left,t=this.getOffset("top",s)+25-s.offsetTop+$(s).position().top,s.remove(),window.getSelection().addRange(n)}o(e,t)},hidePopover:function(){$(this.popover_id).remove()},playAudio:function(o){o&&new Howl({urls:[o]}).play()},transformDefinition:function(o){return'  <div class="popover-definition">'+o.map(function(o,e,t){return'<div class="popover-each-definition">'+t[e]+"</div>"}).join("")+"  </div>"},popover:function(o){var e=o.wordhelper,t=o.webster,i="<div id="+this.popover_id_name+'><div class="popover-inner"><h3 class="popover-title">';!0===e.loading?i+='<p><span class="word">'+e.msg+"</span></p>":1!=e.status_code&&e.data?(i+='<p><span class="word">'+e.data.content+'</span><small class="pronunciation">'+(e.data.pron?"["+e.data.pron+"]":"")+"</small></p>",i+=window.location.protocol.indexOf("https")<0?'<a href="#" class="speak uk">UK<i class="icon icon-speak"></i></a><a href="#" class="speak us">US<i class="icon icon-speak"></i></a></h3>':"</h3>",i+='<div class="popover-content">'+this.transformDefinition(e.data.definition.split("\n"))+"</div>"):i+=void 0===t||""===t.term?"未找到单词</h3></div>":'<p><span class="word">'+t.term+'</span></p></h3><div class="popover-content"><p>'+t.defs+"</p></div>",i+="</div></div>",$(this.popover_id).remove(),$("body").append(i),this.getSelectionOffset(function(o,e){this.setPopoverPosition(o,e)}.bind(this)),$(this.popover_id+" .speak.us").click(function(o){o.preventDefault();var t="http://media.shanbay.com/audio/us/"+e.data.content+".mp3";this.playAudio(t)}.bind(this)),$(this.popover_id+" .speak.uk").click(function(o){o.preventDefault();var t="http://media.shanbay.com/audio/uk/"+e.data.content+".mp3";this.playAudio(t)}.bind(this)),$("html").click(function(){this.hidePopover()}.bind(this)),$("body").on("click",this.popover_id,function(o){})}};!function(o){o(document).ready(function(){o(document).on("dblclick",function(){var e=document.getSelection(),t=e.getRangeAt(0);if(t){var i=t.toString();i&&new RegExp(/^[a-z]+$/i).test(i)&&(i=i.toLowerCase(),WordHelper.popover({wordhelper:{loading:!0,msg:"正在查询..."}}),o.ajax({url:"http://shanbay.com/api/v1/bdc/search/?word="+i+"&_="+(new Date).getTime(),method:"GET",dataType:"json",success:function(o){WordHelper.popover({wordhelper:{loading:!1,data:o.data,status_code:o.status_code,msg:o.msg}})}.bind(e),error:function(o){console.log("Word Helper Search Error "+o.toString())}}))}})})}($);